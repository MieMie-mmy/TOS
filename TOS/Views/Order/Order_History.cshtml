
@{
    ViewBag.Title = "Order_History";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Style link-->
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />

<link href="~/Content/Site.css" rel="stylesheet" />

<link href="~/Content/monthly.css" rel="stylesheet" />
<link href="~/Content/morris.css" rel="stylesheet" />
<link href="~/Content/news.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>

<script src="~/Scripts/jquery-3.3.1.js"></script>
<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<!--Order History page link-->
<link href="~/Content/order_history.css" rel="stylesheet" />

<ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="index.html">ホーム</a><i class="fa fa-angle-right"></i>発注履歴</li>
</ol>


<div class="inbox-mail">
    <!-- tab content -->
    <div class="tab-content tab-content-in w3">
        <div class="tab-pane text-style active" id="tab1">
            <div class="inbox-right" style="overflow:scroll;">
                全商品発注できました。
                <table class="histoptab" id="Order_First">
                    <thead>
                        <tr class="histoptabtit">
                            <td class="tda t150">発注番号</td>
                            <td class="tda t150">合計金額</td>
                            <td class="tda t200">出荷先名</td>
                            <td class="tda t150">発注日</td>
                            <td class="tda t150">出荷可能日</td>
                            <td class="tda t100">受付時間</td>

                            <td class="histoptabno t200"></td>
                            <td class="histoptabno t200"></td>
                            <td class="histoptabno t200">
                                <button type="button" id="PrintDoc" onclick="location.href='@Url.Action("ExportReport","Order")'" class="btn btn-info btn-lg ">✏&nbsp;出力</button>
                            </td>
                            <td class="histoptabno t200"></td>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="inbox-mail">

    <!-- tab content -->
    <div class="tab-content tab-content-in w3">
        <div class="tab-pane text-style active" id="tab1">
            <div class="inbox-right">

                <div class="mailbox-content" id="mailbox-content">
                    <div class="mail-toolbar clearfix">

                        <table class="hacyuban">
                            <tbody>
                                <tr>
                                    <td class="t550">
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td>発注番号</td>
                                                    <td> <input type="text" id="txt_orderId" class="form-control" placeholder=""></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                    <td class="t700">
                                        <table>
                                            <tbody>
                                                <tr class="sair">
                                                    <td class="t100">発注日</td>
                                                    <td>

                                                        <label class="nativeDatePicker">
                                                            <input type="date" name="bday" id="orderdate_from" onchange="check_orderdate()" class="form-control">

                                                        </label>～
                                                        <label class="nativeDatePicker">
                                                            <input type="date" name="bday" id="orderdate_to" onchange="check_orderdate()" class="form-control">

                                                        </label>
                                                        <fieldset class="fallbackDatePicker" hidden>
                                                            <legend class="fallbackLabel">Enter your birthday:</legend>

                                                            <label>
                                                                Day:
                                                                <select name="day"></select>
                                                            </label>

                                                            <label>
                                                                Month:
                                                                <select name="month">
                                                                    <option>January</option>
                                                                    <option>February</option>
                                                                    <option>March</option>
                                                                    <option>April</option>
                                                                    <option>May</option>
                                                                    <option>June</option>
                                                                    <option>July</option>
                                                                    <option>August</option>
                                                                    <option>September</option>
                                                                    <option>October</option>
                                                                    <option>November</option>
                                                                    <option>December</option>
                                                                </select>
                                                            </label>

                                                            <label>
                                                                Year:
                                                                <select name="year"></select>
                                                            </label>
                                                        </fieldset>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                    <td>&nbsp;</td>
                                    <td class="t250">&nbsp;</td>
                                    <td class="saicc">
                                        <button type="button" id="textbox_clear" onclick="_ClearRefresh()" class="btn btn-warning">↺&nbsp;リセット</button>
                                    </td>
                                    <td class="t70 sair">&nbsp;</td>
                                </tr>
                                <tr>
                                    <td>
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td>出荷日</td>
                                                    <td>
                                                        <label class="nativeDatePicker">
                                                            <input type="date" name="bday" id="shipdate_from" onchange="check_shipdate()" class="form-control">

                                                        </label>～
                                                        <label class="nativeDatePicker">
                                                            <input type="date" name="bday" id="shipdate_to" onchange="check_shipdate()" class="form-control">

                                                        </label>
                                                        <fieldset class="fallbackDatePicker" hidden>
                                                            <legend class="fallbackLabel">Enter your birthday:</legend>

                                                            <label>
                                                                Day:
                                                                <select name="day"></select>
                                                            </label>

                                                            <label>
                                                                Month:
                                                                <select name="month">
                                                                    <option>January</option>
                                                                    <option>February</option>
                                                                    <option>March</option>
                                                                    <option>April</option>
                                                                    <option>May</option>
                                                                    <option>June</option>
                                                                    <option>July</option>
                                                                    <option>August</option>
                                                                    <option>September</option>
                                                                    <option>October</option>
                                                                    <option>November</option>
                                                                    <option>December</option>
                                                                </select>
                                                            </label>

                                                            <label>
                                                                Year:
                                                                <select name="year"></select>
                                                            </label>
                                                        </fieldset>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                    <td>
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td class="t100">メーカー番号</td>
                                                    <td>
                                                        <table class="mekaban">
                                                            <tbody>
                                                                <tr>
                                                                    <td class="mekabantit t30">1</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_1" placeholder=""></td>
                                                                    <td class="mekabantit t30">2</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_2" placeholder=""></td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="mekabantit">3</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_3" placeholder=""></td>
                                                                    <td class="mekabantit">4</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_4" placeholder=""></td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="mekabantit">5</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_5" placeholder=""></td>
                                                                    <td class="mekabantit">6</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_6" placeholder=""></td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="mekabantit" class="tab002tit">7</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_7" placeholder=""></td>
                                                                    <td class="mekabantit">8</td>
                                                                    <td><input type="text" class="form-control" id="MakerItemCD_8" placeholder=""></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                    <td>&nbsp;</td>
                                    <td class="saict"><button type="button" onclick="_SearchData()" class="btn btn-secondary btn-lg" id="Searchdata"><i class="fa fa-search" aria-hidden="true"></i>&nbsp;検索</button></td>
                                    <td>
                                        <br><br><br><br><br><br>
                                        <button type="button" id="btn_cancle0" data-toggle="modal" data-target="#myModal" class="btn btn-dark">✖&nbsp;発注キャンセル</button>
                                        <button type="button" id="btn_cancle1" data-toggle="modal" data-target="#myModalSuccess" class="btn btn-dark">✖&nbsp;発注キャンセル</button>
                                        <button type="button" id="btn_cancle2" data-toggle="modal" data-target="#myModalInfo" class="btn btn-dark">✖&nbsp;発注キャンセル</button>

                                        <button type="button" id="btn_cancle" onclick="_CancleTableRow()" class="btn btn-dark">✖&nbsp;発注キャンセル</button>

                                    </td>

                                </tr>
                            </tbody>
                        </table>


                    </div>
                    <!--modal-->
                    <!--Add second table-->
                    <div class="tab-content tab-content-in w3 orderlist">
                        <div class="tab-pane text-style active" id="tab1">


                            <div class="mailbox-content">
                                <div style="overflow:scroll">
                                    <!---->
                                    <table class="tab002" id="order_detail">
                                        <thead>
                                            <tr class="tab002tit">
                                                <td class="t30" id="ID">No</td>
                                                <td class="checkAll">&nbsp;</td>
                                                <td class="t100">発注番号</td>
                                                <td class="t100">商品番号</td>
                                                <td class="t250">商品名</td>
                                                <td class="t70">サイズ</td>
                                                <td class="t100">カラー</td>
                                                <td class="t70">発注数</td>
                                                <td class="t70">引当数</td>
                                                <td class="t100">下代</td>
                                                <td class="t100">合計</td>
                                                <td class="t150">発注日</td>
                                                <td class="t150">発注時刻</td>
                                                <td class="t150">出荷日</td>
                                                <td class="t300">摘要</td>
                                                <td class="t300" hidden>AdminCD</td>
                                                <td class="t150" hidden>OrderStatus</td>
                                            </tr>
                                        </thead>
                                        <tbody id="order_detail_body"></tbody>
                                    </table>
                                </div>
                                <!---->
                            </div>



                        </div>
                    </div>
                    <!--end second table-->


                </div>
            </div>
        </div>

    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">

                @*<h4 class="modal-title" style="color:red;"><img src="~/images/DeleteImg.png" /> 削除してよろしいですか。</h4>*@
                <img src="~/images/question.png"style="width:26px;height:26px;" /> <h4 class="modal-title"  style="color:red;"> </h4>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="color:white;background-color:red;">いいえ</button>
                <button type="button" class="btn btn-default" onclick="_CancleRow()" data-dismiss="modal" style="color:white;background-color:red">はい</button>
            </div>
        </div>

    </div>
</div>

<div class="modal fade" id="myModalSuccess" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">

                <img src="~/images/SuccessImg.jpg" style="width:26px;height:26px;" />   <h4 class="modal-title" style="color:forestgreen;"> </h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="color:white;background-color:forestgreen;">閉じる</button>

            </div>
        </div>

    </div>
</div>
<div class="modal fade" id="myModalInfo" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">

                <img src="~/images/info.jpg" style="width:26px;height:26px;" /> <h4 class="modal-title" style="color:#003492;"></h4>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="color:white;background-color:#003492;">閉じる</button>

            </div>
        </div>

    </div>
</div>

@*</div>*@
<!-- 2'nd table script-->

<style>
    .modal-header img{
        display:inline-block;
    }
    .modal-header h4{
        display:inline-block
    }

    table.dataTable thead td {
        padding: 8px 10px;
        border-bottom-color: white;
    }


    .dataTables_wrapper.no-footer .dataTables_scrollBody {
        border-bottom: 1px solid #111;
        border-bottom-color: white;
    }

    .OrderStatus_5 {
        color: red;
    }

    .ffss {
        color: white;
    }

    .tab002 {
        width: 1500px !important;
    }

    .histoptab {
        width: 100% !important;
    }

    .mother-grid-inner {
        display: block !important;
        background-color: #edecec !important;
    }

    .left-content {
        background-color: #edecec !important;
    }
</style>

<script>
    $(document).ready(function () {
        $("#btn_cancle1").hide();
        $("#btn_cancle2").hide();
        $("#btn_cancle0").hide();
        FillGrid_1();
        FillGrid_2();

        var input1 = document.getElementById("txt_orderId");
        input1.addEventListener("keyup", function (event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("Searchdata").click();
            }
        });
    });
    function FillGrid_1() {

            $.ajax({
                type: 'POST',
                url: "../Order/OH_GetFirstTable/"+"101",
                dataType: 'json',
                success: function (data) {
                    BindFirstTable(data);

                }
            });

    }

    function FillGrid_2()
    {
        $.ajax({
            type: 'POST',
            url: "../Order/OH_GetSecondTable/"+"101",

            dataType: 'json',

            success: function (data) {
                BindSecondTable(data);

            }
        });

    }


    function FillGrid_3(id, o_f, o_t, s_f, s_t, m1, m2, m3, m4, m5, m6, m7, m8)
    {
        $.ajax({
            type: 'POST',
            url: "@Url.Action("OH_GetSecondTable", "Order")",
            dataType: 'json',
            data: {
                id: id,
                o_f: o_f,
                o_t: o_t,
                s_f: s_f,
                s_t: s_t,
                m1: m1,
                m2: m2,
                m3: m3,
                m4: m4,
                m5: m5,
                m6: m6,
                m7: m7,
                m8: m8

            },
            success: function (data) {
                BindSecondTable(data);

            }
        });

    }

    function BindFirstTable(data)
    {

        var table = $("#Order_First").DataTable(
            {

                "destroy": true,
                //responsive: false,
                "scrollX": true,
                //"scrollY": true,
                "dom": 'lrtip',
                "bLengthChange": false,
                "data": data,
                "language": {
                    "emptyTable": "検索結果がありません。"
                },
                "columns": [
                    { "data": "OrderID", orderable: false },
                    { "data": "TotalAmount", orderable: false },
                    { "data": "ShippingName", orderable: false },
                    { "data": "OrderDateTime_h", orderable: false },
                    { "data": "AvailableShippingDate", orderable: false },
                    { "data": "OrderDateTime_d", orderable: false },
                    { "data": null, orderable: false },
                    { "data": null, orderable: false },
                    { "data": null, orderable: false },
                    { "data": null, orderable: false }

                ],
                "columnDefs": [

                    {
                        targets: [0, 1, 2, 3, 4,5],
                        className: 'tda saict'
                    },
                    {
                        targets: [6,7,8,9],
                        className: 'histoptabno sair ffss',

                    },

                    ],




            }
        );

    }


    function BindSecondTable(data)
    {
        $("#order_detail").find("tbody tr").empty();

        var table = $("#order_detail").DataTable(
            {
                "destroy": true,
                //responsive: false,
                "scrollX": true,
                "dom": 'lrtip',
                "bLengthChange": false,

                "data": data,
                "language": {
                    "emptyTable": "検索結果がありません。"
                },
                "createdRow": function (row, data, dataIndex) {
                    $(row).addClass("odr1");
                },
                "columns": [
                    { "data": "No", orderable: false },
                    {},
                    { "data": "OrderID", orderable: false },
                    { "data": "MakerItemAdminCD", orderable: false },
                    { "data": "ItemName", orderable: false },
                    { "data": "SizeName", orderable: false },
                    { "data": "ColorName", orderable: false },
                    { "data": "OrderItem", orderable: false },
                    { "data": "StockItem", orderable: false },
                    { "data": "SalePrice", orderable: false },
                    { "data": "TotalAmount", orderable: false },
                    { "data": "OrderDate", orderable: false },
                    { "data": "OrderTime", orderable: false },
                    { "data": "ShippingDate", orderable: false },
                    { "data": "Memo", orderable: false },
                    { "data": "AdminCD", orderable: false },
                    { "data": "OrderStatus", orderable: false },


                ],

                "columnDefs": [
                    {
                        "targets": 1,
                        className:'saict odr1',
                        "data": "",
                        "render": function (data, type, row) {

                            return '<input type="checkbox" value="' + row.OrderID + '" id="horns" class="checkBox" name="' + row.AdminCD + '">';

                        }
                    },
                    {
                        targets: [0, 5, 6, 7, 8, 11, 12, 13],
                        className: 'saict'
                    },
                    {
                        targets: [9, 10],
                        className: 'sair '
                    },
                    {
                        targets: [2, 3, 4, 14],
                        className: 'sailf '
                    },
                    {
                        targets: [15,16],
                        className: 'sailf ',
                        visible: false

                    },

                ],
                "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                    if (aData.OrderStatus == 5) {

                        $('td', nRow).css('color', 'red');
                    }
                    else if (aData.OrderStatus == "5") {
                        $('td', nRow).css('color', 'red');
                    }

                }

            }
        );

    }




</script>
<!--button's function script-->
<script>

    function _ClearRefresh() {

        document.getElementById('txt_orderId').value = "";
        document.getElementById('orderdate_from').value = "";
        document.getElementById('orderdate_to').value = "";
        document.getElementById('shipdate_from').value = "";
        document.getElementById('shipdate_to').value = "";
        document.getElementById('MakerItemCD_1').value = "";
        document.getElementById('MakerItemCD_2').value = "";
        document.getElementById('MakerItemCD_3').value = "";
        document.getElementById('MakerItemCD_4').value = "";
        document.getElementById('MakerItemCD_5').value = "";
        document.getElementById('MakerItemCD_6').value = "";
        document.getElementById('MakerItemCD_7').value = "";
        document.getElementById('MakerItemCD_8').value = "";
        RefreshFirstTable();


        RefreshSecondTable();


    }
    function RefreshFirstTable() {
        $.ajax({
            type: 'POST',
            url: "../Order/OH_GetFirstTable",
            dataType: 'json',
            success: function (data) {
                BindFirstTable(data);

            }
        });
    }
    function RefreshSecondTable() {
        $.ajax({
            type: 'POST',
            url: "../Order/OH_GetSecondTable",

            dataType: 'json',

            success: function (data) {
                BindSecondTable(data);

            }
        });
    }
    function _CancleTableRow() {

        var checked = jQuery('input:checkbox:checked').map(function () {

            return this.value + '_' + this.name;

        }).get();
   
        if (checked == "") {
            var E = "E";
            var T = "1001";
            var M = "Message1";
            Infomessage(E,T,M);
          
        }
        else {
            var Q = "Q";
            var K = "1001";
            var M = "Message1";
            Confrimmessage(Q,K,M);
        }

    }
    
    function _CancleRow() {
        var checked = jQuery('input:checkbox:checked').map(function () {
            return this.value + '_' + this.name;

        }).get();

        $.ajax({
            url: "/Order/Delete_OderHistoryDetailRow/" + checked,

            type: 'POST',
            dataType: 'JSON',

            success: function (data) {
                if (data == "OK") {
                    var Q = "Q";
                    var K = "1001";
                    var M = "Message2";
                    Successmessage(Q,K,M);
                    jQuery('input:checkbox:checked').parents("tr").remove();
                  
                    RefreshSecondTable();
                   

                }

            }


        });

    }
    function Successmessage(t,k,m) {
        $.ajax({
            type: 'POST',
            url: "../Order/OrderHistoryMessage/" + t + '_' + k + '_' + m,
            dataType: 'json',
            success: function (data) {
                $('.modal-title').text(data);

                $("#btn_cancle1").click();

            }
        }); 
    }
   
    function Infomessage(t,k,m) {
        $.ajax({
            type: 'POST',
            url: "../Order/OrderHistoryMessage/" + t + '_' + k + '_' + m,
            dataType: 'json',
            success: function (data) {
                $('.modal-title').text(data);

                $("#btn_cancle2").click();

            }
        }); 
    }
    function Confrimmessage(t,k,m) {
        $.ajax({
            type: 'POST',
            url: "../Order/OrderHistoryMessage/" + t + '_' + k + '_' + m,
            dataType: 'json',
            success: function (data) {
                $('.modal-title').text(data);

                $("#btn_cancle0").click();

            }
        });         

    }
    function check_orderdate()
    {
        
        var fromDate = document.getElementById("orderdate_from").value;
        var toDate = document.getElementById("orderdate_to").value;
        if ((fromDate != "" && toDate != "") && Date.parse(fromDate) > Date.parse(toDate)) {
             //alert("To date should be greater than From date.");
           
            var T = "E";
            var K = "1003";
            var M = "Message1";
            Infomessage(T,K,M);

          
        }
       
    }
    function check_shipdate()
    {
        var fromDate = document.getElementById("shipdate_from").value;
        var toDate = document.getElementById("shipdate_to").value;
        if ((fromDate != "" && toDate != "") && Date.parse(fromDate) > Date.parse(toDate)) {
            //alert("To date should be greater than From date.");
            var T = "E";
            var K = "1003";
            var M = "Message1";
            Infomessage(T, K, M);
        }
       
    }
    function _SearchData() {

        var txt_orderId = document.getElementById('txt_orderId').value;
        var orderdate_from = document.getElementById('orderdate_from').value;
        var orderdate_to = document.getElementById('orderdate_to').value;
        var shipdate_from = document.getElementById('shipdate_from').value;
        var shipdate_to = document.getElementById('shipdate_to').value;
        var MakerItemCD_1 = document.getElementById('MakerItemCD_1').value;
        var MakerItemCD_2 = document.getElementById('MakerItemCD_2').value;
        var MakerItemCD_3 = document.getElementById('MakerItemCD_3').value;
        var MakerItemCD_4 = document.getElementById('MakerItemCD_4').value;
        var MakerItemCD_5 = document.getElementById('MakerItemCD_5').value;
        var MakerItemCD_6 = document.getElementById('MakerItemCD_6').value;
        var MakerItemCD_7 = document.getElementById('MakerItemCD_7').value;
        var MakerItemCD_8 = document.getElementById('MakerItemCD_8').value;
        //check_makeritemcd(MakerItemCD_1, MakerItemCD_2, MakerItemCD_3, MakerItemCD_4, MakerItemCD_5, MakerItemCD_6, MakerItemCD_7, MakerItemCD_8);
        FillGrid_3(txt_orderId, orderdate_from, orderdate_to, shipdate_from, shipdate_to, MakerItemCD_1, MakerItemCD_2, MakerItemCD_3, MakerItemCD_4, MakerItemCD_5, MakerItemCD_6, MakerItemCD_7, MakerItemCD_8);

    }
    //function check_makeritemcd(m1,m2,m3,m4,m5,m6,m7,m8)
    //{
    //    $.ajax({
    //        type: 'POST',
    //        url: "../Order/Check_MakerItemCD",
    //        data: {
    //            m1: m1,
    //            m2: m2,
    //            m3: m3,
    //            m4: m4,
    //            m5: m5,
    //            m6: m6,
    //            m7: m7,
    //            m8: m8
    //        },
    //        dataType: 'json',
    //        success: function (data) {
    //            $('.modal-title').text(data);

    //            $("#btn_cancle0").click();

    //        }
    //    });  
    //}

</script>

